\chapter{Conflation}
\label{2-conflation}

Cílem této kapitoly je přiblížit čtenáři pojem sloučení vektorových map
(\textit{conflation}). Kro\-mě definice samotného pojmu kapitola popisuje 
i~klasifikaci sjednocování map a~obecný postup při této úloze. Hned zpočátku
bych však ráda upozornila na~to, že v~angličtině používaný pojem 
\textit{conflation} nemá žádný oficiální český ekvivalent, proto je v~některých
případech uveden v~originálním znění, aby nemohlo dojít k~špatnému výkladu 
textu.

\section{Definice pojmu \textit{conflation}}
\label{definice}

Pojem \textit{conflation} byl poprvé v~souvislosti s~kartografií a~\zk{GIS}
použit manželkou Jamese Corbetta, matematika působícího v~US~Census Bureau.
Termín pochází z~latinského \textit{con flare}, což znamená \uv{rozdmýchávat}
nebo doslovněji \uv{foukat dohromady}. Ještě před tím, než se toto slovo 
objevilo v~digitální kartografii, používalo se pro popis spojování dvou 
rukopisů do~třetí verze, která je kombinací těchto předchozích.

\textit{Conflation} lze do~češtiny přeložit jako slučování či spojování map. 
Překlad tohoto pojmu však není vždy jasný, jelikož se jím označuje více různých 
úloh, procesů či činností. Někdy bývá tento výraz zaměňován s~anglickými 
termíny \textit{map matching, map merging, rubber sheeting} atd., které obecně
označují činnosti spadající do této oblasti. Jelikož žádná oficiální česká
definice tohoto pojmu neexistuje, jsou zde uvedeny překlady definic z~různých 
zahraničních zdrojů. 

\begin{itemize}

  \item Sada činností, které vzájemně zarovnávají prvky dvou geografických
    datových vrstev a~následně převádí atributy jedné vrstvy do~druhé.
    
    (Wiki.GIS.com - The GIS Encyclopedia Glossary, 
    \url{http://wiki.gis.com/wiki/index.php/GIS\_Glossary/C},
    citováno 30.~4.~2013)

  \item \textit{Feature conflation} je proces kombinování geografických 
    informací z~překrývajících se zdrojových dat, který zachovává přesnost 
    dat, minimalizuje nadbytečná data a~předchází konfliktům v~datech.
    Potřeba \textit{conflation} vyvstává s~nutností aktualizace dat kvůli
    přesnosti či chybějícím prvkům/atributům pomocí novějších datových zdrojů
    zahrnujících překrývající se území.
    \textit{Conflation of geospatial data} (geoprostorových dat) je spojení
    či sladění dvou různých prostorových datasetů zahrnujících stejné území.
     
    (Shekhar, Xiong: Encyclopedia of GIS \cite[][s.~129]{gisencyclopedia})

  \item Proces sjednocení dvou rozdílných datasetů.
    
    (Blasby, Davis, Kim, Ramsey: GIS Conflation Using Open Source Tools 
    \cite[][s.~2]{opensourceconflation})

 \item \textit{Conflation} je proces, jehož cílem je geometricky upravit 
    (posunem, transformací) di\-gitální data zobrazující stejné území 
    (obvykle pořízená v~jiném čase) tak, aby byla vzájemně geograficky 
    \uv{korektní} a~vzájemně se překrývaly.
    
    (HUIC Data Services, \url{http://huic.com/HUIC/job/right/conflation.htm}, 
     citováno 30.~4.~2013)

  \item Schopnost kombinovat data z~různých zdrojů do~jednoho společného
    datasetu je jedním ze~základních problémů v~\zk{GIS}. Tato úloha je
    ve~vědecké literatuře označována jako \textit{conflation} prostorových
    dat.
   
    (Freitas, Afonso: Distributed Vector Based Spatial Data Conflation 
    Services \cite[][s.~23]{freitas})

  \item Soubor funkcí a~procedur, které zarovnávají prvky jednoho \zk{GIS} 
    souboru k~prvkům jiného a~následně převádí atributy mezi~těmito vrstvami.
    Zarovnání předchází převodu atributů a~je nejčestěji prováděno 
    \textit{rubber-sheeting} operacemi.
   
    (Prince George's County - GIS Glossary,
    \url{http://www.princegeorgescountymd.gov/Government/AgencyIndex/OITC/GIS/glossary.asp#C},
    citováno 30.~4.~2013)

  \item Proces sladění poloh odpovídajících si prvků v~různých datových 
    vrstvách. Funkce pro spojení map (\textit{conflation}) provádějí toto 
    sladění tak, aby se odpovídající si prvky přesně překrývaly. 
    
    (Geographic Information Nova Scotia - Standards Manual,
    \url{http://www.gov.ns.ca/snsmr/land/standards/post/manual/appedxa1.asp#C},
     citováno 30.~4.~2013)

\end{itemize}

\section{Historie}
\label{historie}

Až do 80.~let 20.~století bylo pořízení digitálních dat velmi drahé, a~proto 
se často nestávalo, že by nějaká firma vlastnila více mapových souborů jediného 
území. S~vývojem počítačů a~digitálních technologií se však tato data stávala 
stále do\-stupnějšími a~náhle vyvstala potřeba kombinovat data o~jednom území 
z~více zdrojů a~provádění aktualizace těchto dat. 

Jako první se k~takovému množství dat dostaly pochopitelně různé vládní 
instituce. Ačkoli první článek o~problematice spojování geografických dat 
z~více zdrojů vyšel už v~roce 1981 (\textit{M. White: The~Theory of~Geographical
Data Conflation}), k~opravdovému rozvoji došlo až po~roce 1985. V~té době 
totiž vznikl projekt, jehož cílem bylo propojení mapových souborů organizací
US~Census Bureau a~US~Geological Society. Vzhledem k~množství dat bylo nutné
celý proces co nejvíce auto\-matizovat. Použitý algoritmus, jehož hlavním autorem
je Alan Saalfeld, byl založen na~nalezení odpovídajících si prvků a~následné 
transformaci dat. 

S~narůstající dostupností dat a~zveřejněním této myšlenky přibývalo i~menších 
firem zabývajících se problémem kombinace mapových souborů z~různých zdrojů.

Zatímco před dvaceti lety se datasety slučovaly pouze na~základě geometric\-kých 
a~topologických vlastností, dnes stále větší roli hrají i~atributy jednotlivých 
prvků, které mohou práci velmi usnadnit. Nejnovějším přístupem je pak zjišťování 
sémantické podobnosti, která je založena na~porovnávání atributů, datových 
struktur a~vzájemných vztahů.


\section{Klasifikace \textit{conflation}}
\label{klasifikace}

\subsection{Dle území zobrazovaného vstupními vrstvami}
\label{dle-uzemi}
\nopagebreak
\begin{enumerate}
  \item \textbf{Horizontální} 
    \subitem Za~\textit{horizontal conflation} se označují procesy, které 
	zpracovávají data ze~vzájemně sousedících území. Cílem je získat 
	mapové soubory, jejichž hranice na~sebe dokonale navazují, a~to pokud 
	možno bez~ztráty přesnosti.
  \item \textbf{Vertikální} \nopagebreak
    \subitem Při~\textit{vertical conflation} obsahují vstupní data překrývající
	se území. Jde tedy o~dva či více souborů zobrazujících jediné území nebo
	alespoň jeho část. Může se jednat o~dvě verze té samé mapy nebo 
	o~dva datasety s~nějakými společnými prvky a~vlastnostmi. Výsledkem 
	celého procesu je jediný dataset, jehož přesnost není horší než přesnost
	původních dat a~obsahuje informace z~obou zdrojů. Jde tedy o~vylepšenou, 
	obsahově bohatší mapu s~odpovídající přesností. 
\end{enumerate}

\subsection{Dle typu vstupních vrstev}
\label{dle-vstupu}

\begin{enumerate}
  \item \textbf{Imagery to imagery, Raster to raster}
    \subitem Jedná se o~případ, kdy je úkolem na~sebe napasovat dva rastrové 
      mapové soubory. Nejčastěji jde o~ortofoto a~naskenovanou analogovou mapu
      daného území. Pomocí této úlohy můžeme například porovnat starou analogovou
      mapu se~současným stavem reprezentovaným právě leteckým snímkem. 
      Řešení tohoto problému vyžaduje poměrně složité techniky pro~nalezení 
      odpovídajících si objektů. Velmi důležitým faktorem je kvalita a~rozlišení
      vstupních dat.
  \item \textbf{Vector to imagery, vector to raster}
    \subitem Kombinace vektorových a~rastrových dat stejného území se využívá 
      často ke~zpřesnění vektorových dat jejich napasováním na~ortofoto. Hlavní
      náplní této oblasti je vývoj algoritmů umožňujících následující 
      \cite{gisencyclopedia}: 
	      \begin{enumerate}
	       \item Detekce charakteristických hran rastrového obrazu a~jejich 
		  porovnání s~vektorovými daty.
	       \item Využití vektorových dat k~identifikaci hran v~rastru - tzv. 
		  \textit{Snakes algorithm}.
	       \item Užití stereo obrazu, výškových dat a~dalších znalostí
		  pro~porovnání vektorových a~rastrových dat. 
	       \item Využití prostorových informací a~jiných vlastností mapy 
		  (jako např. barev) k~roz\-poznání odpovídajících si prvků.
	      \end{enumerate}
  \item \textbf{Vector to vector} \nopagebreak
    \subitem Případem sloučení dvou vektorových datasetů se zabývá tato práce. 
	Jednou ze~spe\-cifických a~velmi častých aplikací je navázání silničních 
	sítí, dále aktualizace digitál\-ních map aj. Existuje mnoho různých algoritmů
	pro~slučování vektorových dat, přičemž základní přístupy k~řešení problému 
	jsou následující \cite{gisencyclopedia}: 
	      \begin{enumerate}
	       \item Sloučení dat za~pomoci algoritmů, které pracují na~základě 
		  porovnávání geome\-trických vlastností prvků.
	       \item Algoritmy, které berou v~potaz podobnost tvarů prvků a~zároveň
		  podobnost jejich atributů.
	       \item Spojení vektorových dat s~neznámým souřadnicovým systémem 
		  na~základě rozmí\-stění významných bodových prvků (např. křižovatky 
		  cest).
	      \end{enumerate}

\end{enumerate}

  \begin{figure}[H]
    \centering
      \small
      \input{./pictures/klasifikace.pdf_tex}
      \caption{Klasifikace \textit{conflation} dle vstupních vrstev}
      \label{fig:classification}
  \end{figure}

\section{Obecný postup}
\label{postup}

Obecný postup při~slučování vektorových map z~více zdrojů se skládá z~několika
kroků, které jsou uvedeny níže. Jako u~většiny podobných operací je třeba 
nejdříve provést přípravu dat a~následně data zpracovat a~upravit.

\begin{enumerate}
  \item \textbf{Předzpracování dat}
    \subitem Tento krok slouží k~zajištění kompatibility vstupních dat tak, 
      aby bylo možné je porovnávat. Obvykle spočívá v~převedení vstupních 
      datasetů do~stejného souřadnico\-vé\-ho systému, zajištění stejných 
      základních jednotek a~dalších měnších úpravách. 
  \item \textbf{Kontrola kvality dat a~topologické správnosti vrstev}
    \subitem Zde se kontroluje vnitřní konzistence dat každé vstupní vrstvy.
      V~tomto případě záleží především na~požadavcích zvoleného algoritmu 
      pro~sloučení map. Může jít na\-pří\-klad o~odstranění topologických chyb 
      v~dané vrstvě jako jsou nežádoucí drobné překryty či mezery 
      mezi~polygony.
  \item \textbf{Vyhledání odpovídajících si prvků}
      \subitem Následuje vyhledání prvků, které si v~upravovaných datasetech
      odpovídají, tedy zobrazují stejný předmět ve~skutečnosti. Tento krok je 
      nezbytný proto, aby bylo možné rozhodnout, jak na~sebe vstupní vrstvy 
      navazují.
  \item \textbf{Sloučení geometrických prvků a/nebo atributů}
      \subitem Po~rozpoznání odpovídajících si prvků je možné upravit 
      geometrii\footnote{Geometrií je v~tomto případě myšlen tvar a~poloha 
      geometrického útvaru.} či atributy prvku z~jedné vrstvy s~přihlédnutím 
      k~vlastnostem prvku z~druhé vrstvy. Při~procesu slučování různých datasetů 
      lze převádět atributové hodnoty mezi~odpo\-vídajícími si prvky nebo změnit  
      geometrii prvku tak, aby odpovídala geometrii prvku z~jiné vrstvy, která 
      bývá označena za~referenční. Ve~slo\-ži\-tějších úlohách už je možné převádět 
      zároveň atributy i~geometrii, a~to nejen jednosměrně (tedy z~vrstvy referenční 
      do~vrstvy upravované), ale výsledkem může být vrstva, jejíž geometrické
      vlastnosti vychází z~kombinace obou vstupních datasetů.
  \item \textbf{Závěrečné úpravy}
      \subitem Po~provedení automatického a~někdy i~manuálního sloučení datových
      vrstev je vhodné provést kontrolu výsledku. Často jsou potřeba ještě drobné
      úpravy, aby výsledná data odpovídala počátečním požadavkům. Ne vždy jsou 
      totiž při~automatickém procesu určeny správně všechny odpovídající si prvky
      a~některé algoritmy mohou při~úpravě geometrických vlastností narušit 
      topologickou správnost dat.
\end{enumerate}
